<?xml version="1.0"?>
<!--
    This file is maintained by Ansible - CHANGES WILL BE OVERWRITTEN
-->
<job_conf>
    <plugins workers="3">
        <plugin id="dynamic" type="runner">
            <!-- These live in the virtualenv -->
            <param id="rules_module">usegalaxy.jobs.rules</param>
        </plugin>
        <plugin id="local" type="runner" load="galaxy.jobs.runners.local:LocalJobRunner"/>
        <plugin id="slurm" type="runner" load="galaxy.jobs.runners.slurm:SlurmJobRunner">
            <param id="drmaa_library_path">/usr/lib64/libdrmaa.so</param>
            <param id="invalidjobexception_retries">5</param>
            <param id="internalexception_retries">5</param>
        </plugin>
        <plugin id="pulsar_jetstream_iu" type="runner" load="galaxy.jobs.runners.pulsar:PulsarMQJobRunner">
            <param id="amqp_url">{{ galaxy_job_conf_amqp_url }}</param>
            <param id="galaxy_url">https://test.galaxyproject.org</param>
            <param id="manager">jetstream_iu</param>
            <param id="persistence_directory">/srv/galaxy/test/var/pulsar_amqp_ack</param>
            <param id="amqp_acknowledge">True</param>
            <param id="amqp_ack_republish_time">180</param>
            <param id="amqp_consumer_timeout">2.0</param>
            <param id="amqp_publish_retry">True</param>
            <param id="amqp_publish_retry_max_retries">60</param>
        </plugin>
        <plugin id="pulsar_jetstream_iu_nagios" type="runner" load="galaxy.jobs.runners.pulsar:PulsarMQJobRunner">
            <param id="amqp_url">{{ galaxy_job_conf_amqp_url }}</param>
            <param id="galaxy_url">https://test.galaxyproject.org</param>
            <param id="manager">jetstream_iu_nagios</param>
            <param id="persistence_directory">/srv/galaxy/test/var/pulsar_amqp_ack</param>
            <param id="amqp_acknowledge">True</param>
            <param id="amqp_ack_republish_time">180</param>
            <param id="amqp_consumer_timeout">2.0</param>
            <param id="amqp_publish_retry">True</param>
            <param id="amqp_publish_retry_max_retries">60</param>
        </plugin>
        <plugin id="pulsar_jetstream_tacc" type="runner" load="galaxy.jobs.runners.pulsar:PulsarMQJobRunner">
            <param id="amqp_url">{{ galaxy_job_conf_amqp_url }}</param>
            <param id="galaxy_url">https://test.galaxyproject.org</param>
            <param id="manager">jetstream_tacc</param>
            <param id="persistence_directory">/srv/galaxy/test/var/pulsar_amqp_ack</param>
            <param id="amqp_acknowledge">True</param>
            <param id="amqp_ack_republish_time">180</param>
            <param id="amqp_consumer_timeout">2.0</param>
            <param id="amqp_publish_retry">True</param>
            <param id="amqp_publish_retry_max_retries">60</param>
        </plugin>
        <plugin id="pulsar_jetstream_tacc_nagios" type="runner" load="galaxy.jobs.runners.pulsar:PulsarMQJobRunner">
            <param id="amqp_url">{{ galaxy_job_conf_amqp_url }}</param>
            <param id="galaxy_url">https://test.galaxyproject.org</param>
            <param id="manager">jetstream_tacc_nagios</param>
            <param id="persistence_directory">/srv/galaxy/test/var/pulsar_amqp_ack</param>
            <param id="amqp_acknowledge">True</param>
            <param id="amqp_ack_republish_time">180</param>
            <param id="amqp_consumer_timeout">2.0</param>
            <param id="amqp_publish_retry">True</param>
            <param id="amqp_publish_retry_max_retries">60</param>
        </plugin>
        <plugin id="amqp_pulsar_stampede" type="runner" load="galaxy.jobs.runners.pulsar:PulsarMQJobRunner">
            <param id="amqp_url">{{ galaxy_job_conf_amqp_url }}</param>
            <param id="galaxy_url">https://test.galaxyproject.org</param>
            <param id="manager">stampede</param>
            <param id="persistence_directory">/srv/galaxy/test/var/pulsar_amqp_ack</param>
            <param id="amqp_acknowledge">True</param>
            <param id="amqp_ack_republish_time">180</param>
            <param id="amqp_consumer_timeout">2.0</param>
            <param id="amqp_publish_retry">True</param>
            <param id="amqp_publish_retry_max_retries">60</param>
        </plugin>
        <plugin id="amqp_pulsar_stampede_nagios" type="runner" load="galaxy.jobs.runners.pulsar:PulsarMQJobRunner">
            <param id="amqp_url">{{ galaxy_job_conf_amqp_url }}</param>
            <param id="galaxy_url">https://test.galaxyproject.org</param>
            <param id="manager">stampede_nagios</param>
            <param id="persistence_directory">/srv/galaxy/test/var/pulsar_amqp_ack</param>
            <param id="amqp_acknowledge">True</param>
            <param id="amqp_ack_republish_time">180</param>
            <param id="amqp_consumer_timeout">2.0</param>
            <param id="amqp_publish_retry">True</param>
            <param id="amqp_publish_retry_max_retries">60</param>
        </plugin>
        <plugin id="amqp_pulsar_bridges" type="runner" load="galaxy.jobs.runners.pulsar:PulsarMQJobRunner">
            <param id="amqp_url">{{ galaxy_job_conf_amqp_url }}</param>
            <param id="galaxy_url">https://test.galaxyproject.org</param>
            <param id="manager">bridges</param>
            <param id="persistence_directory">/srv/galaxy/test/var/pulsar_amqp_ack</param>
            <param id="amqp_acknowledge">True</param>
            <param id="amqp_ack_republish_time">180</param>
            <param id="amqp_consumer_timeout">2.0</param>
            <param id="amqp_publish_retry">True</param>
            <param id="amqp_publish_retry_max_retries">60</param>
        </plugin>
        <plugin id="amqp_pulsar_bridges_nagios" type="runner" load="galaxy.jobs.runners.pulsar:PulsarMQJobRunner">
            <param id="amqp_url">{{ galaxy_job_conf_amqp_url }}</param>
            <param id="galaxy_url">https://test.galaxyproject.org</param>
            <param id="manager">bridges_nagios</param>
            <param id="persistence_directory">/srv/galaxy/test/var/pulsar_amqp_ack</param>
            <param id="amqp_acknowledge">True</param>
            <param id="amqp_ack_republish_time">180</param>
            <param id="amqp_consumer_timeout">2.0</param>
            <param id="amqp_publish_retry">True</param>
            <param id="amqp_publish_retry_max_retries">60</param>
        </plugin>
    </plugins>
    <handlers default="handlers">
        <handler id="test_handler0" tags="handlers">
            <plugin id="local"/>
            <plugin id="slurm"/>
        </handler>
        <handler id="test_handler1" tags="handlers">
            <plugin id="local"/>
            <plugin id="slurm"/>
        </handler>
        <handler id="test_handler2">
            <plugin id="amqp_pulsar_bridges"/>
            <plugin id="amqp_pulsar_bridges_nagios"/>
            <plugin id="pulsar_jetstream_iu"/>
            <plugin id="pulsar_jetstream_iu_nagios"/>
            <plugin id="pulsar_jetstream_tacc"/>
            <plugin id="pulsar_jetstream_tacc_nagios"/>
            <plugin id="slurm"/>
        </handler>
        <handler id="test_handler3" tags="multi_handlers">
            <plugin id="amqp_pulsar_stampede"/>
            <plugin id="amqp_pulsar_stampede_nagios"/>
            <plugin id="pulsar_jetstream_iu"/>
            <plugin id="pulsar_jetstream_iu_nagios"/>
            <plugin id="pulsar_jetstream_tacc"/>
            <plugin id="pulsar_jetstream_tacc_nagios"/>
            <plugin id="slurm"/>
        </handler>
        <handler id="test_handler4" tags="multi_handlers">
            <plugin id="amqp_pulsar_stampede"/>
            <plugin id="amqp_pulsar_stampede_nagios"/>
            <plugin id="pulsar_jetstream_iu"/>
            <plugin id="pulsar_jetstream_iu_nagios"/>
            <plugin id="pulsar_jetstream_tacc"/>
            <plugin id="pulsar_jetstream_tacc_nagios"/>
            <plugin id="slurm"/>
        </handler>
        <handler id="galaxy_datamanager">
            <plugin id="slurm"/>
        </handler>
    </handlers>
    <destinations default="dynamic_normal_reserved">
        <!-- dynamic methods for selecting reserved nodes -->
        <destination id="dynamic_normal_reserved" runner="dynamic">
            <param id="type">python</param>
            <param id="function">dynamic_normal_reserved</param>
        </destination>
        <destination id="dynamic_normal_reserved_16gb" runner="dynamic">
            <param id="type">python</param>
            <param id="function">dynamic_normal_reserved_16gb</param>
        </destination>
        <destination id="dynamic_normal_reserved_32gb" runner="dynamic">
            <param id="type">python</param>
            <param id="function">dynamic_normal_reserved_32gb</param>
        </destination>
        <destination id="dynamic_normal_reserved_64gb" runner="dynamic">
            <param id="type">python</param>
            <param id="function">dynamic_normal_reserved_64gb</param>
        </destination>
        <destination id="dynamic_multi_reserved" runner="dynamic">
            <param id="type">python</param>
            <param id="function">dynamic_multi_reserved</param>
        </destination>

        <!-- dynamic method for setting roundup multi walltime, also handles the explicit Stampede resource selector -->
        <destination id="dynamic_local_stampede_select_dynamic_walltime" runner="dynamic">
            <param id="type">python</param>
            <param id="function">dynamic_local_stampede_select_dynamic_walltime</param>
        </destination>

        <destination id="dynamic_multi_bridges_select" runner="dynamic">
            <param id="type">python</param>
            <param id="function">dynamic_multi_bridges_select</param>
        </destination>

        <!-- dynamic method for the stampede-only selector -->
        <destination id="dynamic_stampede_select" runner="dynamic">
            <param id="type">python</param>
            <param id="function">dynamic_stampede_select</param>
        </destination>

        <!-- dynamic method for the bridges-only selector -->
        <destination id="dynamic_bridges_select" runner="dynamic">
            <param id="type">python</param>
            <param id="function">dynamic_bridges_select</param>
        </destination>

        <!-- dynamic memory rule for the naive variant caller -->
        <destination id="dynamic_nvc_dynamic_memory" runner="dynamic">
            <param id="type">python</param>
            <param id="function">nvc_dynamic_memory</param>
        </destination>

        <!-- reserved destinations -->
        <destination id="reserved" runner="slurm">
            <param id="nativeSpecification">--time=36:00:00 --clusters=roundup --nodes=1 --ntasks=1 --partition=reserved</param>
            <!-- FIXME -->
            <!-- cloudmap tools are still using R 2.11(!) from here, also the genome diversity tools use things in /galaxy/software -->
            <env id="PATH">/galaxy/test/linux-x86_64/bin:/galaxy/software/linux-x86_64/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin</env>
            <env id="LC_ALL">C</env>
            <env id="TEMP">$(dirname ${BASH_SOURCE[0]})/_galaxy_tmp</env>
            <env id="TMPDIR">$TEMP</env>
            <env id="_JAVA_OPTIONS">-Djava.io.tmpdir=$TEMP -Xmx7680m -Xms256m</env>
            <env exec="mkdir -p $TEMP" />
            <env file="/cvmfs/test.galaxyproject.org/venv/bin/activate" />
        </destination>
        <destination id="reserved_16gb" runner="slurm">
            <param id="nativeSpecification">--time=36:00:00 --clusters=roundup --nodes=1 --ntasks=1 --partition=reserved --mem-per-cpu=15360</param>
            <env id="PATH">/galaxy/test/linux-x86_64/bin:/galaxy/software/linux-x86_64/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin</env>
            <env id="LC_ALL">C</env>
            <env id="TEMP">$(dirname ${BASH_SOURCE[0]})/_galaxy_tmp</env>
            <env id="TMPDIR">$TEMP</env>
            <env id="_JAVA_OPTIONS">-Djava.io.tmpdir=$TEMP -Xmx15872m -Xms256m</env>
            <env exec="mkdir -p $TEMP" />
            <env file="/cvmfs/test.galaxyproject.org/venv/bin/activate" />
        </destination>
        <destination id="reserved_32gb" runner="slurm">
            <param id="nativeSpecification">--time=36:00:00 --clusters=roundup --nodes=1 --ntasks=1 --partition=reserved --mem-per-cpu=30720</param>
            <env id="PATH">/galaxy/test/linux-x86_64/bin:/galaxy/software/linux-x86_64/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin</env>
            <env id="LC_ALL">C</env>
            <env id="TEMP">$(dirname ${BASH_SOURCE[0]})/_galaxy_tmp</env>
            <env id="TMPDIR">$TEMP</env>
            <env id="_JAVA_OPTIONS">-Djava.io.tmpdir=$TEMP -Xmx32256m -Xms256m</env>
            <env exec="mkdir -p $TEMP" />
            <env file="/cvmfs/test.galaxyproject.org/venv/bin/activate" />
        </destination>
        <destination id="reserved_64gb" runner="slurm">
            <param id="nativeSpecification">--time=36:00:00 --clusters=roundup --nodes=1 --ntasks=1 --partition=reserved --mem-per-cpu=61440</param>
            <env id="PATH">/galaxy/test/linux-x86_64/bin:/galaxy/software/linux-x86_64/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin</env>
            <env id="LC_ALL">C</env>
            <env id="TEMP">$(dirname ${BASH_SOURCE[0]})/_galaxy_tmp</env>
            <env id="TMPDIR">$TEMP</env>
            <env id="_JAVA_OPTIONS">-Djava.io.tmpdir=$TEMP -Xmx65024m -Xms256m</env>
            <env exec="mkdir -p $TEMP" />
            <env file="/cvmfs/test.galaxyproject.org/venv/bin/activate" />
        </destination>
        <destination id="reserved_multi" runner="slurm">
            <param id="nativeSpecification">--time=36:00:00 --clusters=roundup --nodes=1 --ntasks=6 --partition=reserved --mem-per-cpu=5120</param>
            <env id="PATH">/galaxy/test/linux-x86_64/bin:/galaxy/software/linux-x86_64/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin</env>
            <env id="LC_ALL">C</env>
            <env id="TEMP">$(dirname ${BASH_SOURCE[0]})/_galaxy_tmp</env>
            <env id="TMPDIR">$TEMP</env>
            <env id="_JAVA_OPTIONS">-Djava.io.tmpdir=$TEMP</env>
            <env exec="mkdir -p $TEMP" />
            <env file="/cvmfs/test.galaxyproject.org/venv/bin/activate" />
        </destination>
        <!-- dynamic must append ntasks -->
        <destination id="reserved_dynamic" runner="slurm">
            <param id="nativeSpecification">--time=144:00:00 --clusters=roundup --nodes=1 --partition=reserved --mem-per-cpu=5120</param>
            <env file="/cvmfs/test.galaxyproject.org/venv/bin/activate" />
        </destination>

        <!-- normal destinations -->
        <destination id="slurm_normal" runner="slurm">
            <param id="nativeSpecification">--time=24:00:00 --clusters=roundup --nodes=1 --ntasks=1 --partition=normal</param>
            <env id="PATH">/galaxy/test/linux-x86_64/bin:/galaxy/software/linux-x86_64/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin</env>
            <env id="LC_ALL">C</env>
            <env id="TEMP">$(dirname ${BASH_SOURCE[0]})/_galaxy_tmp</env>
            <env id="TMPDIR">$TEMP</env>
            <env id="_JAVA_OPTIONS">-Djava.io.tmpdir=$TEMP -Xmx7680m -Xms256m</env>
            <env exec="mkdir -p $TEMP" />
            <env file="/cvmfs/test.galaxyproject.org/venv/bin/activate" />
        </destination>
        <destination id="slurm_normal_16gb" runner="slurm">
            <param id="nativeSpecification">--time=24:00:00 --clusters=roundup --nodes=1 --ntasks=1 --partition=normal --mem-per-cpu=15360</param>
            <env id="PATH">/galaxy/test/linux-x86_64/bin:/galaxy/software/linux-x86_64/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin</env>
            <env id="LC_ALL">C</env>
            <env id="TEMP">$(dirname ${BASH_SOURCE[0]})/_galaxy_tmp</env>
            <env id="TMPDIR">$TEMP</env>
            <env id="_JAVA_OPTIONS">-Djava.io.tmpdir=$TEMP -Xmx15872m -Xms256m</env>
            <env exec="mkdir -p $TEMP" />
            <env file="/cvmfs/test.galaxyproject.org/venv/bin/activate" />
        </destination>
        <destination id="slurm_normal_32gb" runner="slurm">
            <param id="nativeSpecification">--time=24:00:00 --clusters=roundup --nodes=1 --ntasks=1 --partition=normal --mem-per-cpu=30720</param>
            <env id="PATH">/galaxy/test/linux-x86_64/bin:/galaxy/software/linux-x86_64/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin</env>
            <env id="LC_ALL">C</env>
            <env id="TEMP">$(dirname ${BASH_SOURCE[0]})/_galaxy_tmp</env>
            <env id="TMPDIR">$TEMP</env>
            <env id="_JAVA_OPTIONS">-Djava.io.tmpdir=$TEMP -Xmx32256m -Xms256m</env>
            <env exec="mkdir -p $TEMP" />
            <env file="/cvmfs/test.galaxyproject.org/venv/bin/activate" />
        </destination>
        <destination id="slurm_normal_64gb" runner="slurm">
            <param id="nativeSpecification">--time=24:00:00 --nodes=1 --ntasks=1 --partition=multi --mem-per-cpu=61440</param>
            <env id="PATH">/galaxy/test/linux-x86_64/bin:/galaxy/software/linux-x86_64/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin</env>
            <env id="LC_ALL">C</env>
            <env id="TEMP">$(dirname ${BASH_SOURCE[0]})/_galaxy_tmp</env>
            <env id="TMPDIR">$TEMP</env>
            <env id="_JAVA_OPTIONS">-Djava.io.tmpdir=$TEMP -Xmx65024m -Xms256m</env>
            <env exec="mkdir -p $TEMP" />
            <env file="/cvmfs/test.galaxyproject.org/venv/bin/activate" />
        </destination>

        <destination id="slurm_multi" runner="slurm">
            <param id="nativeSpecification">--time=24:00:00 --nodes=1 --ntasks=6 --partition=multi</param>
            <env id="PATH">/galaxy/test/linux-x86_64/bin:/galaxy/software/linux-x86_64/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin</env>
            <env id="LC_ALL">C</env>
            <env id="TEMP">$(dirname ${BASH_SOURCE[0]})/_galaxy_tmp</env>
            <env id="TMPDIR">$TEMP</env>
            <env id="_JAVA_OPTIONS">-Djava.io.tmpdir=$TEMP</env>
            <env exec="mkdir -p $TEMP" />
            <env file="/cvmfs/test.galaxyproject.org/venv/bin/activate" />
        </destination>
        <destination id="slurm_multi_trackster" runner="slurm">
            <param id="nativeSpecification">--time=00:05:00 --nodes=1 --ntasks=6 --partition=single</param>
            <env file="/cvmfs/test.galaxyproject.org/venv/bin/activate" />
        </destination>
        <destination id="slurm_multi_development" runner="slurm">
            <param id="nativeSpecification">--time=00:30:00 --clusters=roundup --nodes=1 --ntasks=2 --partition=normal</param>
            <env file="/cvmfs/test.galaxyproject.org/venv/bin/activate" />
        </destination>
        <destination id="slurm_multi_16c_128gb" runner="slurm">
            <param id="nativeSpecification">--nodes=1 --ntasks=16 --mem-per-cpu=7680 --partition=multi</param>
            <env file="/cvmfs/test.galaxyproject.org/venv/bin/activate" />
        </destination>

        <!-- Jetstream destinations -->
        <destination id="jetstream_multi" runner="dynamic">
            <!-- this destination exists for the dynamic runner to read the native spec for testing -->
            <param id="nativeSpecification">--time=36:00:00 --nodes=1 --partition=multi</param>
        </destination>
        <destination id="jetstream_iu_multi" runner="pulsar_jetstream_iu" tags="jetstream">
            <param id="transport">curl</param>
            <param id="default_file_action">remote_transfer</param>
            <param id="dependency_resolution">remote</param>
            <param id="remote_metadata">true</param>
            <param id="use_remote_datatypes">true</param>
            <param id="rewrite_parameters">true</param>
            <param id="remote_property_galaxy_home">/cvmfs/{{ galaxy_instance_codename }}.galaxyproject.org/galaxy</param>
            <param id="remote_property_galaxy_datatypes_config_file">/cvmfs/{{ galaxy_instance_codename }}.galaxyproject.org/config/datatypes_conf.xml</param>
            <param id="jobs_directory">/jetstream/scratch0/{{ galaxy_instance_codename }}/jobs</param>
            <param id="submit_native_specification">--time=36:00:00 --nodes=1 --partition=multi</param>
            <param id="file_action_config">{{ galaxy_config_dir }}/pulsar_jetstream_actions.yml</param>
            <env file="/cvmfs/{{ galaxy_instance_codename }}.galaxyproject.org/venv/bin/activate" />
            <env id="LC_ALL">C</env>
            <env id="TEMP">$(dirname ${BASH_SOURCE[0]})/working</env>
            <env id="TMPDIR">$TEMP</env>
            <env id="_JAVA_OPTIONS">-Djava.io.tmpdir=$TEMP</env>
        </destination>
        <destination id="jetstream_iu_nagios" runner="pulsar_jetstream_iu_nagios" tags="jetstream">
            <param id="transport">curl</param>
            <param id="default_file_action">remote_transfer</param>
            <param id="dependency_resolution">remote</param>
            <param id="remote_metadata">true</param>
            <param id="use_remote_datatypes">true</param>
            <param id="rewrite_parameters">true</param>
            <param id="remote_property_galaxy_home">/cvmfs/{{ galaxy_instance_codename }}.galaxyproject.org/galaxy</param>
            <param id="remote_property_galaxy_datatypes_config_file">/cvmfs/{{ galaxy_instance_codename }}.galaxyproject.org/config/datatypes_conf.xml</param>
            <param id="jobs_directory">/jetstream/scratch0/{{ galaxy_instance_codename }}/jobs</param>
            <param id="file_action_config">{{ galaxy_config_dir }}/pulsar_jetstream_actions.yml</param>
            <env file="/cvmfs/{{ galaxy_instance_codename }}.galaxyproject.org/venv/bin/activate" />
            <env id="LC_ALL">C</env>
            <env id="TEMP">$(dirname ${BASH_SOURCE[0]})/working</env>
            <env id="TMPDIR">$TEMP</env>
            <env id="_JAVA_OPTIONS">-Djava.io.tmpdir=$TEMP</env>
        </destination>
        <destination id="jetstream_tacc_multi" runner="pulsar_jetstream_tacc" tags="jetstream">
            <param id="transport">curl</param>
            <param id="default_file_action">remote_transfer</param>
            <param id="dependency_resolution">remote</param>
            <param id="remote_metadata">true</param>
            <param id="use_remote_datatypes">true</param>
            <param id="rewrite_parameters">true</param>
            <param id="jobs_directory">/jetstream/scratch0/{{ galaxy_instance_codename }}/jobs</param>
            <param id="remote_property_galaxy_home">/cvmfs/{{ galaxy_instance_codename }}.galaxyproject.org/galaxy</param>
            <param id="remote_property_galaxy_datatypes_config_file">/cvmfs/{{ galaxy_instance_codename }}.galaxyproject.org/config/datatypes_conf.xml</param>
            <param id="submit_native_specification">--time=36:00:00 --nodes=1 --partition=multi</param>
            <param id="file_action_config">{{ galaxy_config_dir }}/pulsar_jetstream_actions.yml</param>
            <env file="/cvmfs/{{ galaxy_instance_codename }}.galaxyproject.org/venv/bin/activate" />
            <env id="LC_ALL">C</env>
            <env id="TEMP">$(dirname ${BASH_SOURCE[0]})/working</env>
            <env id="TMPDIR">$TEMP</env>
            <env id="_JAVA_OPTIONS">-Djava.io.tmpdir=$TEMP</env>
        </destination>
        <destination id="jetstream_tacc_nagios" runner="pulsar_jetstream_tacc_nagios" tags="jetstream">
            <param id="transport">curl</param>
            <param id="default_file_action">remote_transfer</param>
            <param id="dependency_resolution">remote</param>
            <param id="remote_metadata">true</param>
            <param id="use_remote_datatypes">true</param>
            <param id="rewrite_parameters">true</param>
            <param id="jobs_directory">/jetstream/scratch0/{{ galaxy_instance_codename }}/jobs</param>
            <param id="remote_property_galaxy_home">/cvmfs/{{ galaxy_instance_codename }}.galaxyproject.org/galaxy</param>
            <param id="remote_property_galaxy_datatypes_config_file">/cvmfs/{{ galaxy_instance_codename }}.galaxyproject.org/config/datatypes_conf.xml</param>
            <param id="file_action_config">{{ galaxy_config_dir }}/pulsar_jetstream_actions.yml</param>
            <env file="/cvmfs/{{ galaxy_instance_codename }}.galaxyproject.org/venv/bin/activate" />
            <env id="LC_ALL">C</env>
            <env id="TEMP">$(dirname ${BASH_SOURCE[0]})/working</env>
            <env id="TMPDIR">$TEMP</env>
            <env id="_JAVA_OPTIONS">-Djava.io.tmpdir=$TEMP</env>
        </destination>

        <!-- dynamic modified destinations: do not use directly -->
        <destination id="slurm_multi_dynamic_walltime" runner="slurm">
            <!-- walltime is set dynamically -->
            <param id="nativeSpecification">--nodes=1 --ntasks=6 --partition=multi</param>
            <resubmit condition="walltime_reached" destination="pulsar_stampede_normal" handler="test_handler4"/>
            <env file="/cvmfs/test.galaxyproject.org/venv/bin/activate" />
        </destination>
        <destination id="slurm_normal_dynamic_mem" runner="slurm">
            <!-- clusters and mem-per-cpu are set dynamically -->
            <param id="nativeSpecification">--time=24:00:00 --nodes=1 --ntasks=1</param>
            <env file="/cvmfs/test.galaxyproject.org/venv/bin/activate" />
        </destination>

        <!-- stampede destinations -->
        <destination id="pulsar_stampede_normal" runner="amqp_pulsar_stampede">
            <param id="transport">curl</param>
            <param id="default_file_action">remote_transfer</param>
            <param id="dependency_resolution">remote</param>
            <param id="remote_metadata">true</param>
            <param id="use_remote_datatypes">true</param>
            <param id="rewrite_parameters">true</param>
            <param id="jobs_directory">/scratch/03166/xcgalaxy/test/staging/</param>
            <param id="remote_property_galaxy_home">/work/galaxy/test/galaxy/server</param>
            <param id="remote_property_galaxy_config_file">/work/galaxy/test/galaxy/config/galaxy.ini</param>
            <param id="remote_property_galaxy_datatypes_config_file">/work/galaxy/test/galaxy/config/datatypes_conf.xml</param>
            <param id="submit_native_specification">--time=48:00:00 --nodes=1 --ntasks=16 --partition=normal --account=TG-MCB140147</param>
            <param id="file_action_config">{{ galaxy_config_dir }}/pulsar_stampede_actions.yml</param>
            <param id="submit_user_email">$__user_email__</param>
            <env exec="eval `/opt/apps/lmod/lmod/libexec/lmod bash purge`" />
            <env file="/work/galaxy/test/galaxy/venv/bin/activate" />
        </destination>
        <destination id="pulsar_stampede_development" runner="amqp_pulsar_stampede">
            <param id="transport">curl</param>
            <param id="default_file_action">remote_transfer</param>
            <param id="dependency_resolution">remote</param>
            <param id="remote_metadata">true</param>
            <param id="use_remote_datatypes">true</param>
            <param id="rewrite_parameters">true</param>
            <param id="jobs_directory">/scratch/03166/xcgalaxy/test/staging/</param>
            <param id="remote_property_galaxy_home">/work/galaxy/test/galaxy/server</param>
            <param id="remote_property_galaxy_config_file">/work/galaxy/test/galaxy/config/galaxy.ini</param>
            <param id="remote_property_galaxy_datatypes_config_file">/work/galaxy/test/galaxy/config/datatypes_conf.xml</param>
            <param id="submit_native_specification">--time=00:30:00 --nodes=1 --ntasks=16 --partition=development --account=TG-MCB140147</param>
            <param id="file_action_config">{{ galaxy_config_dir }}/pulsar_stampede_actions.yml</param>
            <param id="submit_user_email">$__user_email__</param>
            <env exec="eval `/opt/apps/lmod/lmod/libexec/lmod bash purge`" />
            <env file="/work/galaxy/test/galaxy/venv/bin/activate" />
        </destination>
        <destination id="pulsar_stampede_nagios" runner="amqp_pulsar_stampede_nagios">
            <param id="transport">curl</param>
            <param id="default_file_action">remote_transfer</param>
            <param id="dependency_resolution">remote</param>
            <param id="use_remote_datatypes">true</param>
            <param id="rewrite_parameters">true</param>
            <param id="jobs_directory">/scratch/03166/xcgalaxy/test/staging/</param>
            <param id="remote_property_galaxy_home">/work/galaxy/test/galaxy/server</param>
            <param id="remote_property_galaxy_config_file">/work/galaxy/test/galaxy/config/galaxy.ini</param>
            <param id="remote_property_galaxy_datatypes_config_file">/work/galaxy/test/galaxy/config/datatypes_conf.xml</param>
            <param id="file_action_config">{{ galaxy_config_dir }}/pulsar_stampede_actions.yml</param>
            <env exec="eval `/opt/apps/lmod/lmod/libexec/lmod bash purge`" />
            <env file="/work/galaxy/test/galaxy/venv/bin/activate" />
        </destination>

        <!-- bridges destinations -->
        <destination id="pulsar_bridges_normal" runner="amqp_pulsar_bridges">
            <param id="transport">curl</param>
            <param id="default_file_action">remote_transfer</param>
            <param id="dependency_resolution">remote</param>
            <param id="remote_metadata">true</param>
            <param id="use_remote_datatypes">true</param>
            <param id="rewrite_parameters">true</param>
            <param id="jobs_directory">/pylon5/mc48nsp/xcgalaxy/test_staging/</param>
            <param id="remote_property_galaxy_home">/pylon2/mc48nsp/xcgalaxy/test/galaxy/server</param>
            <param id="remote_property_galaxy_config_file">/pylon2/mc48nsp/xcgalaxy/test/galaxy/config/galaxy.ini</param>
            <param id="remote_property_galaxy_datatypes_config_file">/pylon2/mc48nsp/xcgalaxy/test/galaxy/config/datatypes_conf.xml</param>
            <!-- walltime and mem are set dynamically -->
            <!-- use constraint to avoid running on xl nodes, which do not mount /pylon5 -->
            <param id="submit_native_specification">-p LM --constraint=LM</param>
            <param id="submit_user_email">$__user_email__</param>
            <param id="file_action_config">{{ galaxy_config_dir }}/pulsar_bridges_actions.yml</param>
            <env exec="eval `modulecmd sh purge`" />
            <env file="/pylon2/mc48nsp/xcgalaxy/test/galaxy/venv/bin/activate" />
        </destination>
        <destination id="pulsar_bridges_development" runner="amqp_pulsar_bridges">
            <param id="transport">curl</param>
            <param id="default_file_action">remote_transfer</param>
            <param id="dependency_resolution">remote</param>
            <param id="remote_metadata">true</param>
            <param id="use_remote_datatypes">true</param>
            <param id="rewrite_parameters">true</param>
            <param id="jobs_directory">/pylon5/mc48nsp/xcgalaxy/test_staging/</param>
            <param id="remote_property_galaxy_home">/pylon2/mc48nsp/xcgalaxy/test/galaxy/server</param>
            <param id="remote_property_galaxy_config_file">/pylon2/mc48nsp/xcgalaxy/test/galaxy/config/galaxy.ini</param>
            <param id="remote_property_galaxy_datatypes_config_file">/pylon2/mc48nsp/xcgalaxy/test/galaxy/config/datatypes_conf.xml</param>
            <!-- 147456 MB == 144 GB (3 cores) (128GB is the minimum for LM) -->
            <param id="submit_native_specification">-p LM -t 00:30:00 --mem=147456</param>
            <param id="submit_user_email">$__user_email__</param>
            <param id="file_action_config">{{ galaxy_config_dir }}/pulsar_bridges_actions.yml</param>
            <env exec="eval `modulecmd sh purge`" />
            <env file="/pylon2/mc48nsp/xcgalaxy/test/galaxy/venv/bin/activate" />
        </destination>
        <destination id="pulsar_bridges_nagios" runner="amqp_pulsar_bridges_nagios">
            <param id="transport">curl</param>
            <param id="default_file_action">remote_transfer</param>
            <param id="dependency_resolution">remote</param>
            <param id="use_remote_datatypes">true</param>
            <param id="rewrite_parameters">true</param>
            <param id="jobs_directory">/pylon5/mc48nsp/xcgalaxy/test_staging/</param>
            <param id="remote_property_galaxy_home">/pylon2/mc48nsp/xcgalaxy/test/galaxy/server</param>
            <param id="remote_property_galaxy_config_file">/pylon2/mc48nsp/xcgalaxy/test/galaxy/config/galaxy.ini</param>
            <param id="remote_property_galaxy_datatypes_config_file">/pylon2/mc48nsp/xcgalaxy/test/galaxy/config/datatypes_conf.xml</param>
            <env exec="eval `modulecmd sh purge`" />
            <env file="/pylon2/mc48nsp/xcgalaxy/test/galaxy/venv/bin/activate" />
        </destination>

        <!-- local destination for nagios handler checks -->
        <destination id="local" runner="local"/>

    </destinations>
    <tools>
        <!-- explicit local multi jobs -->
        <tool id="gemini_load" destination="dynamic_multi_reserved" handler="multi_handlers" />
        <tool id="deeptools_bam_compare" destination="dynamic_multi_reserved" handler="multi_handlers" />
        <tool id="deeptools_bam_coverage" destination="dynamic_multi_reserved" handler="multi_handlers" />
        <tool id="deeptools_bam_pe_fragmentsize" destination="dynamic_multi_reserved" handler="multi_handlers" />
        <tool id="deeptools_bigwig_compare" destination="dynamic_multi_reserved" handler="multi_handlers" />
        <tool id="deeptools_compute_gc_bias" destination="dynamic_multi_reserved" handler="multi_handlers" />
        <tool id="deeptools_compute_matrix" destination="dynamic_multi_reserved" handler="multi_handlers" />
        <tool id="deeptools_correct_gc_bias" destination="dynamic_multi_reserved" handler="multi_handlers" />
        <tool id="deeptools_multi_bam_summary" destination="dynamic_multi_reserved" handler="multi_handlers" />
        <tool id="deeptools_multi_bigwig_summary" destination="dynamic_multi_reserved" handler="multi_handlers" />
        <tool id="deeptools_plot_coverage" destination="dynamic_multi_reserved" handler="multi_handlers" />
        <tool id="deeptools_plot_fingerprint" destination="dynamic_multi_reserved" handler="multi_handlers" />
        <tool id="kraken" destination="dynamic_multi_reserved" handler="multi_handlers" />
        <tool id="align_families" destination="dynamic_local_stampede_select_dynamic_walltime" handler="multi_handlers" resources="local_or_stampede"/>
        <!-- explicit stampede jobs -->
        <tool id="megablast_wrapper" destination="dynamic_stampede_select" handler="multi_handlers" resources="stampede"/>
        <tool id="lastz_wrapper_2" destination="dynamic_stampede_select" handler="multi_handlers" resources="stampede"/>
        <tool id="bwa_color_wrapper" destination="dynamic_stampede_select" handler="multi_handlers" resources="stampede"/>
        <tool id="bowtie_color_wrapper" destination="dynamic_stampede_select" handler="multi_handlers" resources="stampede"/>
        <tool id="bowtie_color_wrapper" destination="dynamic_stampede_select" handler="multi_handlers" resources="stampede"/>
        <!-- resubmit to stampede jobs -->
        <tool id="bwa" destination="dynamic_local_stampede_select_dynamic_walltime" handler="multi_handlers" resources="local_or_stampede" />
        <tool id="bwa_mem" destination="dynamic_local_stampede_select_dynamic_walltime" handler="multi_handlers" resources="local_or_stampede"/>
        <tool id="bwa_wrapper" destination="dynamic_local_stampede_select_dynamic_walltime" handler="multi_handlers" resources="local_or_stampede"/>
        <tool id="bowtie2" destination="dynamic_local_stampede_select_dynamic_walltime" handler="multi_handlers" resources="local_or_stampede"/>
        <tool id="bowtie_wrapper" destination="dynamic_local_stampede_select_dynamic_walltime" handler="multi_handlers" resources="local_or_stampede"/>
        <tool id="tophat" destination="dynamic_local_stampede_select_dynamic_walltime" handler="multi_handlers" resources="local_or_stampede"/>
        <tool id="tophat2" destination="dynamic_local_stampede_select_dynamic_walltime" handler="multi_handlers" resources="local_or_stampede"/>
        <tool id="cuffdiff" destination="dynamic_local_stampede_select_dynamic_walltime" handler="multi_handlers" resources="local_or_stampede"/>
        <tool id="cufflinks" destination="dynamic_local_stampede_select_dynamic_walltime" handler="multi_handlers" resources="local_or_stampede"/>
        <tool id="cuffmerge" destination="dynamic_local_stampede_select_dynamic_walltime" handler="multi_handlers" resources="local_or_stampede"/>
        <tool id="cuffnorm" destination="dynamic_local_stampede_select_dynamic_walltime" handler="multi_handlers"  resources="local_or_stampede"/>
        <tool id="cuffquant" destination="dynamic_local_stampede_select_dynamic_walltime" handler="multi_handlers" resources="local_or_stampede"/>
        <tool id="stringtie" destination="dynamic_local_stampede_select_dynamic_walltime" handler="multi_handlers"  resources="local_or_stampede"/>
        <tool id="hisat2" destination="dynamic_local_stampede_select_dynamic_walltime" handler="multi_handlers"  resources="local_or_stampede"/>
        <tool id="prokka" destination="dynamic_local_stampede_select_dynamic_walltime" handler="multi_handlers"  resources="local_or_stampede"/>
        <!-- roundup multi/jetstream/bridges jobs -->
        <tool id="rna_star" destination="dynamic_multi_bridges_select" handler="test_handler2"  resources="multi_or_bridges"/>
        <!-- bridges jobs -->
        <tool id="trinity_psc" destination="dynamic_bridges_select" handler="test_handler2" resources="bridges"/>
        <tool id="spades" destination="dynamic_bridges_select" handler="test_handler2" resources="bridges"/>
        <tool id="rnaspades" destination="dynamic_bridges_select" handler="test_handler2" resources="bridges"/>
        <!-- trackster jobs -->
        <tool id="cufflinks" destination="slurm_multi_trackster">
            <param id="source">trackster</param>
        </tool>
        <!-- dynamic memory tools -->
        <tool id="naive_variant_caller" destination="dynamic_nvc_dynamic_memory"/>
        <!--
        <tool id="naive_variant_caller" destination="slurm_normal_64gb"/>
        -->
        <!-- data managers -->
        <tool id="data_manager_fetch_genome_all_fasta" destination="reserved" handler="galaxy_datamanager"/>
        <tool id="bwa_mem_index_builder_data_manager" destination="reserved_64gb" handler="galaxy_datamanager"/>
        <tool id="data_manager_bowtie2_index_builder" destination="reserved" handler="galaxy_datamanager"/>
        <tool id="data_manager_bowtie_index_builder" destination="reserved" handler="galaxy_datamanager"/>
        <tool id="data_manager_hisat2_index_builder" destination="reserved_16gb" handler="galaxy_datamanager"/>
        <tool id="kraken_database_builder" destination="slurm_multi_16c_128gb" handler="galaxy_datamanager"/>
        <tool id="rna_star_index_builder_data_manager" destination="slurm_multi_16c_128gb" handler="galaxy_datamanager"/>
        <!-- 16GB tools -->
        <tool id="sailfish" destination="dynamic_normal_reserved_16gb"/>
        <tool id="bamtools" destination="dynamic_normal_reserved_16gb"/>
        <tool id="varscan" destination="dynamic_normal_reserved_16gb"/>
        <tool id="scatterplot_rpy" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_AddCommentsToBam" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_AddOrReplaceReadGroups" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_BedToIntervalList" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_CleanSam" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_CASM" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_CollectBaseDistributionByCycle" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_CollectGcBiasMetrics" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_CollectInsertSizeMetrics" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_CollectRnaSeqMetrics" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_CollectWgsMetrics" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_DownsampleSam" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_EstimateLibraryComplexity" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_FilterSamReads" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_FixMateInformation" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_MarkDuplicates" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_MarkDuplicatesWithMateCigar" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_MeanQualityByCycle" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_MergeBamAlignment" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_MergeSamFiles" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_NormalizeFasta" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_QualityScoreDistribution" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_ReorderSam" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_ReplaceSamHeader" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_RevertOriginalBaseQualitiesAndAddMateCigar" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_RevertSam" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_SamToFastq" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_SortSam" destination="dynamic_normal_reserved_16gb"/>
        <tool id="picard_ValidateSamFile" destination="dynamic_normal_reserved_16gb"/>
        <!-- 64GB tools -->
        <tool id="wig_to_bigWig" destination="dynamic_normal_reserved_64gb"/>
        <tool id="CONVERTER_bedgraph_to_bigwig" destination="dynamic_normal_reserved_64gb"/>
        <!-- nagios checks -->
        <!-- run wherever it lands
        <tool id="echo_test_cluster"/>
        -->
        <tool id="echo_test_handler0" destination="local" handler="test_handler0"/>
        <tool id="echo_test_handler1" destination="local" handler="test_handler1"/>
        <tool id="echo_test_jetstream_iu" destination="jetstream_iu_nagios" handler="multi_handlers"/>
        <tool id="echo_test_jetstream_tacc" destination="jetstream_tacc_nagios" handler="multi_handlers"/>
        <tool id="echo_test_stampede" destination="pulsar_stampede_nagios" handler="multi_handlers"/>
        <tool id="echo_test_bridges" destination="pulsar_bridges_nagios" handler="test_handler2"/>
    </tools>
    <resources default="default">
        <group id="default"></group>
        <group id="local_or_stampede">tacc_compute_resource,team_cpus</group>
        <group id="multi_or_bridges">multi_bridges_compute_resource</group>
        <group id="stampede">stampede_compute_resource</group>
        <group id="bridges">bridges_compute_resource</group>
    </resources>
    <limits>
        <limit type="registered_user_concurrent_jobs">6</limit>
        <limit type="anonymous_user_concurrent_jobs">1</limit>
        <limit type="job_walltime">49:00:00</limit>
        <limit type="output_size">50G</limit>
        <!-- per-destination per-user limits -->
        <limit type="destination_user_concurrent_jobs" id="slurm_normal">6</limit>
        <limit type="destination_user_concurrent_jobs" id="slurm_normal_16gb">2</limit>
        <limit type="destination_user_concurrent_jobs" id="slurm_normal_64gb">1</limit>
        <limit type="destination_user_concurrent_jobs" id="slurm_multi">1</limit>
        <limit type="destination_user_concurrent_jobs" id="reserved">8</limit>
        <limit type="destination_user_concurrent_jobs" id="reserved_16gb">8</limit>
        <limit type="destination_user_concurrent_jobs" id="reserved_64gb">8</limit>
        <limit type="destination_user_concurrent_jobs" id="reserved_multi">8</limit>
        <limit type="destination_user_concurrent_jobs" id="slurm_multi_dynamic_walltime">2</limit>
        <limit type="destination_user_concurrent_jobs" id="slurm_multi_development">1</limit>
        <limit type="destination_user_concurrent_jobs" id="slurm_multi_trackster">1</limit>
        <limit type="destination_user_concurrent_jobs" id="pulsar_stampede_normal">3</limit>
        <limit type="destination_user_concurrent_jobs" id="pulsar_stampede_development">1</limit>
        <limit type="destination_user_concurrent_jobs" id="pulsar_bridges_normal">6</limit>
        <limit type="destination_user_concurrent_jobs" id="pulsar_bridges_development">1</limit>
        <limit type="destination_user_concurrent_jobs" id="jetstream">4</limit>
        <!-- per-destination total limits -->
        <limit type="destination_total_concurrent_jobs" id="pulsar_stampede_normal">50</limit>
        <limit type="destination_total_concurrent_jobs" id="pulsar_stampede_development">1</limit>
        <limit type="destination_total_concurrent_jobs" id="pulsar_bridges_normal">10</limit>
        <limit type="destination_total_concurrent_jobs" id="pulsar_bridges_development">1</limit>
    </limits>
</job_conf>
